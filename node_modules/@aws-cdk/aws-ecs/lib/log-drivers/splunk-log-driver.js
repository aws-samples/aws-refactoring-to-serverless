"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.SplunkLogDriver = exports.SplunkLogFormat = void 0;
const jsiiDeprecationWarnings = require("../../.warnings.jsii.js");
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const log_driver_1 = require("./log-driver");
const utils_1 = require("./utils");
/**
 * Log Message Format
 */
var SplunkLogFormat;
(function (SplunkLogFormat) {
    SplunkLogFormat["INLINE"] = "inline";
    SplunkLogFormat["JSON"] = "json";
    SplunkLogFormat["RAW"] = "raw";
})(SplunkLogFormat = exports.SplunkLogFormat || (exports.SplunkLogFormat = {}));
/**
 * A log driver that sends log information to splunk Logs.
 */
class SplunkLogDriver extends log_driver_1.LogDriver {
    /**
     * Constructs a new instance of the SplunkLogDriver class.
     *
     * @param props the splunk log driver configuration options.
     */
    constructor(props) {
        super();
        this.props = props;
        try {
            jsiiDeprecationWarnings._aws_cdk_aws_ecs_SplunkLogDriverProps(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, SplunkLogDriver);
            }
            throw error;
        }
        if (!props.token && !props.secretToken) {
            throw new Error('Please provide either token or secretToken.');
        }
        if (props.gzipLevel) {
            utils_1.ensureInRange(props.gzipLevel, -1, 9);
        }
    }
    /**
     * Called when the log driver is configured on a container
     */
    bind(_scope, _containerDefinition) {
        try {
            jsiiDeprecationWarnings._aws_cdk_aws_ecs_ContainerDefinition(_containerDefinition);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.bind);
            }
            throw error;
        }
        const options = utils_1.stringifyOptions({
            'splunk-token': this.props.token?.unsafeUnwrap(),
            'splunk-url': this.props.url,
            'splunk-source': this.props.source,
            'splunk-sourcetype': this.props.sourceType,
            'splunk-index': this.props.index,
            'splunk-capath': this.props.caPath,
            'splunk-caname': this.props.caName,
            'splunk-insecureskipverify': this.props.insecureSkipVerify,
            'splunk-format': this.props.format,
            'splunk-verify-connection': this.props.verifyConnection,
            'splunk-gzip': this.props.gzip,
            'splunk-gzip-level': this.props.gzipLevel,
            ...utils_1.renderCommonLogDriverOptions(this.props),
        });
        return {
            logDriver: 'splunk',
            options,
            secretOptions: this.props.secretToken && utils_1.renderLogDriverSecretOptions({ 'splunk-token': this.props.secretToken }, _containerDefinition.taskDefinition),
        };
    }
}
exports.SplunkLogDriver = SplunkLogDriver;
_a = JSII_RTTI_SYMBOL_1;
SplunkLogDriver[_a] = { fqn: "@aws-cdk/aws-ecs.SplunkLogDriver", version: "1.172.0" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3BsdW5rLWxvZy1kcml2ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzcGx1bmstbG9nLWRyaXZlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFHQSw2Q0FBMEQ7QUFDMUQsbUNBQXNIO0FBTXRIOztHQUVHO0FBQ0gsSUFBWSxlQUlYO0FBSkQsV0FBWSxlQUFlO0lBQ3pCLG9DQUFpQixDQUFBO0lBQ2pCLGdDQUFhLENBQUE7SUFDYiw4QkFBVyxDQUFBO0FBQ2IsQ0FBQyxFQUpXLGVBQWUsR0FBZix1QkFBZSxLQUFmLHVCQUFlLFFBSTFCO0FBZ0hEOztHQUVHO0FBQ0gsTUFBYSxlQUFnQixTQUFRLHNCQUFTO0lBQzVDOzs7O09BSUc7SUFDSCxZQUE2QixLQUEyQjtRQUN0RCxLQUFLLEVBQUUsQ0FBQztRQURtQixVQUFLLEdBQUwsS0FBSyxDQUFzQjs7Ozs7OytDQU43QyxlQUFlOzs7O1FBU3hCLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsRUFBRTtZQUN0QyxNQUFNLElBQUksS0FBSyxDQUFDLDZDQUE2QyxDQUFDLENBQUM7U0FDaEU7UUFDRCxJQUFJLEtBQUssQ0FBQyxTQUFTLEVBQUU7WUFDbkIscUJBQWEsQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1NBQ3ZDO0tBQ0Y7SUFFRDs7T0FFRztJQUNJLElBQUksQ0FBQyxNQUFxQixFQUFFLG9CQUF5Qzs7Ozs7Ozs7OztRQUMxRSxNQUFNLE9BQU8sR0FBRyx3QkFBZ0IsQ0FBQztZQUMvQixjQUFjLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsWUFBWSxFQUFFO1lBQ2hELFlBQVksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUc7WUFDNUIsZUFBZSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTTtZQUNsQyxtQkFBbUIsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVU7WUFDMUMsY0FBYyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSztZQUNoQyxlQUFlLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNO1lBQ2xDLGVBQWUsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU07WUFDbEMsMkJBQTJCLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxrQkFBa0I7WUFDMUQsZUFBZSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTTtZQUNsQywwQkFBMEIsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQjtZQUN2RCxhQUFhLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJO1lBQzlCLG1CQUFtQixFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUztZQUN6QyxHQUFHLG9DQUE0QixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7U0FDNUMsQ0FBQyxDQUFDO1FBRUgsT0FBTztZQUNMLFNBQVMsRUFBRSxRQUFRO1lBQ25CLE9BQU87WUFDUCxhQUFhLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLElBQUksb0NBQTRCLENBQUMsRUFBRSxjQUFjLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLEVBQUUsRUFBRSxvQkFBb0IsQ0FBQyxjQUFjLENBQUM7U0FDdkosQ0FBQztLQUNIOztBQTFDSCwwQ0EyQ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTZWNyZXRWYWx1ZSB9IGZyb20gJ0Bhd3MtY2RrL2NvcmUnO1xuaW1wb3J0IHsgQ29udGFpbmVyRGVmaW5pdGlvbiwgU2VjcmV0IH0gZnJvbSAnLi4vY29udGFpbmVyLWRlZmluaXRpb24nO1xuaW1wb3J0IHsgQmFzZUxvZ0RyaXZlclByb3BzIH0gZnJvbSAnLi9iYXNlLWxvZy1kcml2ZXInO1xuaW1wb3J0IHsgTG9nRHJpdmVyLCBMb2dEcml2ZXJDb25maWcgfSBmcm9tICcuL2xvZy1kcml2ZXInO1xuaW1wb3J0IHsgZW5zdXJlSW5SYW5nZSwgcmVuZGVyQ29tbW9uTG9nRHJpdmVyT3B0aW9ucywgcmVuZGVyTG9nRHJpdmVyU2VjcmV0T3B0aW9ucywgc3RyaW5naWZ5T3B0aW9ucyB9IGZyb20gJy4vdXRpbHMnO1xuXG4vLyB2MiAtIGtlZXAgdGhpcyBpbXBvcnQgYXMgYSBzZXBhcmF0ZSBzZWN0aW9uIHRvIHJlZHVjZSBtZXJnZSBjb25mbGljdCB3aGVuIGZvcndhcmQgbWVyZ2luZyB3aXRoIHRoZSB2MiBicmFuY2guXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbmltcG9ydCB7IENvbnN0cnVjdCBhcyBDb3JlQ29uc3RydWN0IH0gZnJvbSAnQGF3cy1jZGsvY29yZSc7XG5cbi8qKlxuICogTG9nIE1lc3NhZ2UgRm9ybWF0XG4gKi9cbmV4cG9ydCBlbnVtIFNwbHVua0xvZ0Zvcm1hdCB7XG4gIElOTElORSA9ICdpbmxpbmUnLFxuICBKU09OID0gJ2pzb24nLFxuICBSQVcgPSAncmF3J1xufVxuXG4vKipcbiAqIFNwZWNpZmllcyB0aGUgc3BsdW5rIGxvZyBkcml2ZXIgY29uZmlndXJhdGlvbiBvcHRpb25zLlxuICpcbiAqIFtTb3VyY2VdKGh0dHBzOi8vZG9jcy5kb2NrZXIuY29tL2NvbmZpZy9jb250YWluZXJzL2xvZ2dpbmcvc3BsdW5rLylcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTcGx1bmtMb2dEcml2ZXJQcm9wcyBleHRlbmRzIEJhc2VMb2dEcml2ZXJQcm9wcyB7XG4gIC8qKlxuICAgKiBTcGx1bmsgSFRUUCBFdmVudCBDb2xsZWN0b3IgdG9rZW4uXG4gICAqXG4gICAqIFRoZSBzcGx1bmstdG9rZW4gaXMgYWRkZWQgdG8gdGhlIE9wdGlvbnMgcHJvcGVydHkgb2YgdGhlIExvZyBEcml2ZXIgQ29uZmlndXJhdGlvbi4gU28gdGhlIHNlY3JldCB2YWx1ZSB3aWxsIGJlIHJlc29sdmVkIGFuZFxuICAgKiB2aWV3YWJsZSBpbiBwbGFpbiB0ZXh0IGluIHRoZSBjb25zb2xlLlxuICAgKlxuICAgKiBQbGVhc2UgcHJvdmlkZSBhdCBsZWFzdCBvbmUgb2YgYHRva2VuYCBvciBgc2VjcmV0VG9rZW5gLlxuICAgKiBAZGVwcmVjYXRlZCBVc2Uge0BsaW5rIFNwbHVua0xvZ0RyaXZlclByb3BzLnNlY3JldFRva2VufSBpbnN0ZWFkLlxuICAgKiBAZGVmYXVsdCAtIHRva2VuIG5vdCBwcm92aWRlZC5cbiAgICovXG4gIHJlYWRvbmx5IHRva2VuPzogU2VjcmV0VmFsdWU7XG5cbiAgLyoqXG4gICAqIFNwbHVuayBIVFRQIEV2ZW50IENvbGxlY3RvciB0b2tlbiAoU2VjcmV0KS5cbiAgICpcbiAgICogVGhlIHNwbHVuay10b2tlbiBpcyBhZGRlZCB0byB0aGUgU2VjcmV0T3B0aW9ucyBwcm9wZXJ0eSBvZiB0aGUgTG9nIERyaXZlciBDb25maWd1cmF0aW9uLiBTbyB0aGUgc2VjcmV0IHZhbHVlIHdpbGwgbm90IGJlXG4gICAqIHJlc29sdmVkIG9yIHZpZXdhYmxlIGFzIHBsYWluIHRleHQuXG4gICAqXG4gICAqIFBsZWFzZSBwcm92aWRlIGF0IGxlYXN0IG9uZSBvZiBgdG9rZW5gIG9yIGBzZWNyZXRUb2tlbmAuXG4gICAqIEBkZWZhdWx0IC0gSWYgc2VjcmV0IHRva2VuIGlzIG5vdCBwcm92aWRlZCwgdGhlbiB0aGUgdmFsdWUgcHJvdmlkZWQgaW4gYHRva2VuYCB3aWxsIGJlIHVzZWQuXG4gICAqL1xuICByZWFkb25seSBzZWNyZXRUb2tlbj86IFNlY3JldDtcblxuICAvKipcbiAgICogUGF0aCB0byB5b3VyIFNwbHVuayBFbnRlcnByaXNlLCBzZWxmLXNlcnZpY2UgU3BsdW5rIENsb3VkIGluc3RhbmNlLCBvciBTcGx1bmtcbiAgICogQ2xvdWQgbWFuYWdlZCBjbHVzdGVyIChpbmNsdWRpbmcgcG9ydCBhbmQgc2NoZW1lIHVzZWQgYnkgSFRUUCBFdmVudCBDb2xsZWN0b3IpXG4gICAqIGluIG9uZSBvZiB0aGUgZm9sbG93aW5nIGZvcm1hdHM6IGh0dHBzOi8veW91cl9zcGx1bmtfaW5zdGFuY2U6ODA4OCBvclxuICAgKiBodHRwczovL2lucHV0LXByZC1wLVhYWFhYWFguY2xvdWQuc3BsdW5rLmNvbTo4MDg4IG9yIGh0dHBzOi8vaHR0cC1pbnB1dHMtWFhYWFhYWFguc3BsdW5rY2xvdWQuY29tLlxuICAgKi9cbiAgcmVhZG9ubHkgdXJsOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEV2ZW50IHNvdXJjZS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBzb3VyY2Ugbm90IHNldC5cbiAgICovXG4gIHJlYWRvbmx5IHNvdXJjZT86IHN0cmluZztcblxuICAvKipcbiAgICogRXZlbnQgc291cmNlIHR5cGUuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gc291cmNlVHlwZSBub3Qgc2V0LlxuICAgKi9cbiAgcmVhZG9ubHkgc291cmNlVHlwZT86IHN0cmluZztcblxuICAvKipcbiAgICogRXZlbnQgaW5kZXguXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gaW5kZXggbm90IHNldC5cbiAgICovXG4gIHJlYWRvbmx5IGluZGV4Pzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBQYXRoIHRvIHJvb3QgY2VydGlmaWNhdGUuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gY2FQYXRoIG5vdCBzZXQuXG4gICAqL1xuICByZWFkb25seSBjYVBhdGg/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIE5hbWUgdG8gdXNlIGZvciB2YWxpZGF0aW5nIHNlcnZlciBjZXJ0aWZpY2F0ZS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBUaGUgaG9zdG5hbWUgb2YgdGhlIHNwbHVuay11cmxcbiAgICovXG4gIHJlYWRvbmx5IGNhTmFtZT86IHN0cmluZztcblxuICAvKipcbiAgICogSWdub3JlIHNlcnZlciBjZXJ0aWZpY2F0ZSB2YWxpZGF0aW9uLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIGluc2VjdXJlU2tpcFZlcmlmeSBub3Qgc2V0LlxuICAgKi9cbiAgcmVhZG9ubHkgaW5zZWN1cmVTa2lwVmVyaWZ5Pzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBNZXNzYWdlIGZvcm1hdC4gQ2FuIGJlIGlubGluZSwganNvbiBvciByYXcuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gaW5saW5lXG4gICAqL1xuICByZWFkb25seSBmb3JtYXQ/OiBTcGx1bmtMb2dGb3JtYXQ7XG5cbiAgLyoqXG4gICAqIFZlcmlmeSBvbiBzdGFydCwgdGhhdCBkb2NrZXIgY2FuIGNvbm5lY3QgdG8gU3BsdW5rIHNlcnZlci5cbiAgICpcbiAgICogQGRlZmF1bHQgLSB0cnVlXG4gICAqL1xuICByZWFkb25seSB2ZXJpZnlDb25uZWN0aW9uPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogRW5hYmxlL2Rpc2FibGUgZ3ppcCBjb21wcmVzc2lvbiB0byBzZW5kIGV2ZW50cyB0byBTcGx1bmsgRW50ZXJwcmlzZSBvciBTcGx1bmtcbiAgICogQ2xvdWQgaW5zdGFuY2UuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gZmFsc2VcbiAgICovXG4gIHJlYWRvbmx5IGd6aXA/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBTZXQgY29tcHJlc3Npb24gbGV2ZWwgZm9yIGd6aXAuIFZhbGlkIHZhbHVlcyBhcmUgLTEgKGRlZmF1bHQpLCAwIChubyBjb21wcmVzc2lvbiksXG4gICAqIDEgKGJlc3Qgc3BlZWQpIC4uLiA5IChiZXN0IGNvbXByZXNzaW9uKS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSAtMSAoRGVmYXVsdCBDb21wcmVzc2lvbilcbiAgICovXG4gIHJlYWRvbmx5IGd6aXBMZXZlbD86IG51bWJlcjtcbn1cblxuLyoqXG4gKiBBIGxvZyBkcml2ZXIgdGhhdCBzZW5kcyBsb2cgaW5mb3JtYXRpb24gdG8gc3BsdW5rIExvZ3MuXG4gKi9cbmV4cG9ydCBjbGFzcyBTcGx1bmtMb2dEcml2ZXIgZXh0ZW5kcyBMb2dEcml2ZXIge1xuICAvKipcbiAgICogQ29uc3RydWN0cyBhIG5ldyBpbnN0YW5jZSBvZiB0aGUgU3BsdW5rTG9nRHJpdmVyIGNsYXNzLlxuICAgKlxuICAgKiBAcGFyYW0gcHJvcHMgdGhlIHNwbHVuayBsb2cgZHJpdmVyIGNvbmZpZ3VyYXRpb24gb3B0aW9ucy5cbiAgICovXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgcHJvcHM6IFNwbHVua0xvZ0RyaXZlclByb3BzKSB7XG4gICAgc3VwZXIoKTtcblxuICAgIGlmICghcHJvcHMudG9rZW4gJiYgIXByb3BzLnNlY3JldFRva2VuKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BsZWFzZSBwcm92aWRlIGVpdGhlciB0b2tlbiBvciBzZWNyZXRUb2tlbi4nKTtcbiAgICB9XG4gICAgaWYgKHByb3BzLmd6aXBMZXZlbCkge1xuICAgICAgZW5zdXJlSW5SYW5nZShwcm9wcy5nemlwTGV2ZWwsIC0xLCA5KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2FsbGVkIHdoZW4gdGhlIGxvZyBkcml2ZXIgaXMgY29uZmlndXJlZCBvbiBhIGNvbnRhaW5lclxuICAgKi9cbiAgcHVibGljIGJpbmQoX3Njb3BlOiBDb3JlQ29uc3RydWN0LCBfY29udGFpbmVyRGVmaW5pdGlvbjogQ29udGFpbmVyRGVmaW5pdGlvbik6IExvZ0RyaXZlckNvbmZpZyB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHN0cmluZ2lmeU9wdGlvbnMoe1xuICAgICAgJ3NwbHVuay10b2tlbic6IHRoaXMucHJvcHMudG9rZW4/LnVuc2FmZVVud3JhcCgpLCAvLyBTYWZlIHVzYWdlXG4gICAgICAnc3BsdW5rLXVybCc6IHRoaXMucHJvcHMudXJsLFxuICAgICAgJ3NwbHVuay1zb3VyY2UnOiB0aGlzLnByb3BzLnNvdXJjZSxcbiAgICAgICdzcGx1bmstc291cmNldHlwZSc6IHRoaXMucHJvcHMuc291cmNlVHlwZSxcbiAgICAgICdzcGx1bmstaW5kZXgnOiB0aGlzLnByb3BzLmluZGV4LFxuICAgICAgJ3NwbHVuay1jYXBhdGgnOiB0aGlzLnByb3BzLmNhUGF0aCxcbiAgICAgICdzcGx1bmstY2FuYW1lJzogdGhpcy5wcm9wcy5jYU5hbWUsXG4gICAgICAnc3BsdW5rLWluc2VjdXJlc2tpcHZlcmlmeSc6IHRoaXMucHJvcHMuaW5zZWN1cmVTa2lwVmVyaWZ5LFxuICAgICAgJ3NwbHVuay1mb3JtYXQnOiB0aGlzLnByb3BzLmZvcm1hdCxcbiAgICAgICdzcGx1bmstdmVyaWZ5LWNvbm5lY3Rpb24nOiB0aGlzLnByb3BzLnZlcmlmeUNvbm5lY3Rpb24sXG4gICAgICAnc3BsdW5rLWd6aXAnOiB0aGlzLnByb3BzLmd6aXAsXG4gICAgICAnc3BsdW5rLWd6aXAtbGV2ZWwnOiB0aGlzLnByb3BzLmd6aXBMZXZlbCxcbiAgICAgIC4uLnJlbmRlckNvbW1vbkxvZ0RyaXZlck9wdGlvbnModGhpcy5wcm9wcyksXG4gICAgfSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgbG9nRHJpdmVyOiAnc3BsdW5rJyxcbiAgICAgIG9wdGlvbnMsXG4gICAgICBzZWNyZXRPcHRpb25zOiB0aGlzLnByb3BzLnNlY3JldFRva2VuICYmIHJlbmRlckxvZ0RyaXZlclNlY3JldE9wdGlvbnMoeyAnc3BsdW5rLXRva2VuJzogdGhpcy5wcm9wcy5zZWNyZXRUb2tlbiB9LCBfY29udGFpbmVyRGVmaW5pdGlvbi50YXNrRGVmaW5pdGlvbiksXG4gICAgfTtcbiAgfVxufVxuIl19